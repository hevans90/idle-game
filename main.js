(()=>{"use strict";var __webpack_modules__={359:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.authChecker=void 0;exports.authChecker=async({context},roles)=>{if(0===roles.length)return!0;if(!(null==context?void 0:context.roles))return!1;const idTokenRoles=context.roles;for(const role of roles)if(!idTokenRoles.includes(role))return!1;return!0}},400:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.Auth0API=void 0;const tslib_1=__webpack_require__(752),apollo_datasource_1=__webpack_require__(297),axios_1=tslib_1.__importDefault(__webpack_require__(167));class Auth0API extends apollo_datasource_1.DataSource{constructor(){super(...arguments),this.trySetUserRole=async(id,role)=>this.post(`/users/${id}/roles`,{roles:[role]})}async getManagementToken(){const options={method:"POST",url:`https://${process.env.AUTH0_DOMAIN}/oauth/token/`,headers:{"content-type":"application/json"},data:{grant_type:"client_credentials",client_id:process.env.AUTH0_MANAGEMENT_API_CLIENT_ID,client_secret:process.env.AUTH0_MANAGEMENT_API_CLIENT_SECRET,audience:`https://${process.env.AUTH0_DOMAIN}/api/v2/`}};return axios_1.default.request(options)}async post(path,requestOptions){const{data:{access_token}}=await this.getManagementToken(),options={method:"POST",url:`https://${process.env.AUTH0_DOMAIN}/api/v2`+path,headers:{"content-type":"application/json",authorization:`Bearer ${access_token}`,"cache-control":"no-cache"},data:requestOptions};return axios_1.default.request(options)}}exports.Auth0API=Auth0API},76:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},543:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.FoodAPI=void 0;const apollo_datasource_1=__webpack_require__(297),food_gql_1=__webpack_require__(958);class FoodAPI extends apollo_datasource_1.DataSource{constructor(client){super(),this.trySetDisplayName=async(id,display_name)=>this.client.mutate({mutation:food_gql_1.SetDisplayNameByUserIdDocument,variables:{id,display_name}}),this.client=client}}exports.FoodAPI=FoodAPI},242:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RegisterResolver=void 0;const tslib_1=__webpack_require__(752),type_graphql_1=__webpack_require__(345),context_1=__webpack_require__(76);let Register=class Register{};tslib_1.__decorate([type_graphql_1.Field(),tslib_1.__metadata("design:type",String)],Register.prototype,"updatedName",void 0),Register=tslib_1.__decorate([type_graphql_1.ObjectType()],Register);let RegisterResolver=class RegisterResolver{async setDisplayName(context,displayName){if(!context.id)throw new Error("User id not in token");const resDisplayName=(await context.dataSources.foodAPI.trySetDisplayName(context.id,displayName)).data.update_user_info_by_pk.display_name;if(resDisplayName){await context.dataSources.auth0API.trySetUserRole(context.id,"rol_10vO6MmzARbpP2nL"),console.log(resDisplayName);const shit=new Register;return shit.updatedName=resDisplayName,shit}throw new Error("Failed to insert display name")}};tslib_1.__decorate([type_graphql_1.Mutation((returns=>Register),{nullable:!0}),tslib_1.__param(0,type_graphql_1.Ctx()),tslib_1.__param(1,type_graphql_1.Arg("display_name")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==context_1.Context&&context_1.Context)?_a:Object,String]),tslib_1.__metadata("design:returntype",Promise)],RegisterResolver.prototype,"setDisplayName",null),RegisterResolver=tslib_1.__decorate([type_graphql_1.Resolver((of=>Register))],RegisterResolver),exports.RegisterResolver=RegisterResolver},958:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__(752).__exportStar(__webpack_require__(713),exports)},713:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.useSetDisplayNameByUserIdMutation=exports.SetDisplayNameByUserIdDocument=exports.useSelfLazyQuery=exports.useSelfQuery=exports.SelfDocument=exports.User_Me_Select_Column=exports.User_Info_Update_Column=exports.User_Info_Select_Column=exports.User_Info_Constraint=exports.Road_Update_Column=exports.Road_Select_Column=exports.Road_Constraint=exports.Road_Connection_Update_Column=exports.Road_Connection_Select_Column=exports.Road_Connection_Constraint=exports.Player_Update_Column=exports.Player_Select_Column=exports.Player_Food_Update_Column=exports.Player_Food_Select_Column=exports.Player_Food_Constraint=exports.Player_Constraint=exports.Order_By=exports.House_Update_Column=exports.House_Select_Column=exports.House_Food_Demand_Update_Column=exports.House_Food_Demand_Select_Column=exports.House_Food_Demand_Constraint=exports.House_Constraint=exports.Garden_Update_Column=exports.Garden_Select_Column=exports.Garden_Constraint=exports.Game_Update_Column=exports.Game_Select_Column=exports.Game_Constraint=exports.Employee_Update_Column=exports.Employee_Select_Column=exports.Employee_Constraint=exports.Drink_Update_Column=exports.Drink_Select_Column=exports.Drink_Constraint=exports.Diner_Update_Column=exports.Diner_Select_Column=exports.Diner_Constraint=exports.Board_Object_Update_Column=exports.Board_Object_Select_Column=exports.Board_Object_Constraint=exports.Advert_Update_Column=exports.Advert_Select_Column=exports.Advert_Constraint=void 0;const tslib_1=__webpack_require__(752),client_1=__webpack_require__(114),Apollo=tslib_1.__importStar(__webpack_require__(114)),defaultOptions={};!function(Advert_Constraint){Advert_Constraint.AdvertPkey="advert_pkey"}(exports.Advert_Constraint||(exports.Advert_Constraint={})),function(Advert_Select_Column){Advert_Select_Column.BoardObject="board_object",Advert_Select_Column.FoodKind="food_kind",Advert_Select_Column.FoodQuantity="food_quantity",Advert_Select_Column.Game="game",Advert_Select_Column.Id="id",Advert_Select_Column.Kind="kind"}(exports.Advert_Select_Column||(exports.Advert_Select_Column={})),function(Advert_Update_Column){Advert_Update_Column.BoardObject="board_object",Advert_Update_Column.FoodKind="food_kind",Advert_Update_Column.FoodQuantity="food_quantity",Advert_Update_Column.Game="game",Advert_Update_Column.Id="id",Advert_Update_Column.Kind="kind"}(exports.Advert_Update_Column||(exports.Advert_Update_Column={})),function(Board_Object_Constraint){Board_Object_Constraint.BoardObjectPkey="board_object_pkey"}(exports.Board_Object_Constraint||(exports.Board_Object_Constraint={})),function(Board_Object_Select_Column){Board_Object_Select_Column.I="i",Board_Object_Select_Column.Id="id",Board_Object_Select_Column.J="j",Board_Object_Select_Column.Kind="kind",Board_Object_Select_Column.Rotation="rotation"}(exports.Board_Object_Select_Column||(exports.Board_Object_Select_Column={})),function(Board_Object_Update_Column){Board_Object_Update_Column.I="i",Board_Object_Update_Column.Id="id",Board_Object_Update_Column.J="j",Board_Object_Update_Column.Kind="kind",Board_Object_Update_Column.Rotation="rotation"}(exports.Board_Object_Update_Column||(exports.Board_Object_Update_Column={})),function(Diner_Constraint){Diner_Constraint.DinerPkey="diner_pkey"}(exports.Diner_Constraint||(exports.Diner_Constraint={})),function(Diner_Select_Column){Diner_Select_Column.BoardObject="board_object",Diner_Select_Column.Id="id",Diner_Select_Column.Owner="owner"}(exports.Diner_Select_Column||(exports.Diner_Select_Column={})),function(Diner_Update_Column){Diner_Update_Column.BoardObject="board_object",Diner_Update_Column.Id="id",Diner_Update_Column.Owner="owner"}(exports.Diner_Update_Column||(exports.Diner_Update_Column={})),function(Drink_Constraint){Drink_Constraint.DrinkPkey="drink_pkey"}(exports.Drink_Constraint||(exports.Drink_Constraint={})),function(Drink_Select_Column){Drink_Select_Column.Game="game",Drink_Select_Column.Id="id",Drink_Select_Column.Kind="kind"}(exports.Drink_Select_Column||(exports.Drink_Select_Column={})),function(Drink_Update_Column){Drink_Update_Column.Game="game",Drink_Update_Column.Id="id",Drink_Update_Column.Kind="kind"}(exports.Drink_Update_Column||(exports.Drink_Update_Column={})),function(Employee_Constraint){Employee_Constraint.EmployeePkey="employee_pkey"}(exports.Employee_Constraint||(exports.Employee_Constraint={})),function(Employee_Select_Column){Employee_Select_Column.Game="game",Employee_Select_Column.HiredBy="hired_by",Employee_Select_Column.HiresAvailable="hires_available",Employee_Select_Column.Id="id",Employee_Select_Column.Kind="kind",Employee_Select_Column.Manager="manager",Employee_Select_Column.Owner="owner",Employee_Select_Column.PromotedFrom="promoted_from",Employee_Select_Column.TrainedBy="trained_by",Employee_Select_Column.TrainedFrom="trained_from",Employee_Select_Column.TrainsAvailable="trains_available",Employee_Select_Column.Used="used"}(exports.Employee_Select_Column||(exports.Employee_Select_Column={})),function(Employee_Update_Column){Employee_Update_Column.Game="game",Employee_Update_Column.HiredBy="hired_by",Employee_Update_Column.HiresAvailable="hires_available",Employee_Update_Column.Id="id",Employee_Update_Column.Kind="kind",Employee_Update_Column.Manager="manager",Employee_Update_Column.Owner="owner",Employee_Update_Column.PromotedFrom="promoted_from",Employee_Update_Column.TrainedBy="trained_by",Employee_Update_Column.TrainedFrom="trained_from",Employee_Update_Column.TrainsAvailable="trains_available",Employee_Update_Column.Used="used"}(exports.Employee_Update_Column||(exports.Employee_Update_Column={})),function(Game_Constraint){Game_Constraint.GamePkey="game_pkey"}(exports.Game_Constraint||(exports.Game_Constraint={})),function(Game_Select_Column){Game_Select_Column.Id="id",Game_Select_Column.Name="name"}(exports.Game_Select_Column||(exports.Game_Select_Column={})),function(Game_Update_Column){Game_Update_Column.Id="id",Game_Update_Column.Name="name"}(exports.Game_Update_Column||(exports.Game_Update_Column={})),function(Garden_Constraint){Garden_Constraint.GardenPkey="garden_pkey"}(exports.Garden_Constraint||(exports.Garden_Constraint={})),function(Garden_Select_Column){Garden_Select_Column.BoardObject="board_object",Garden_Select_Column.Game="game",Garden_Select_Column.Id="id"}(exports.Garden_Select_Column||(exports.Garden_Select_Column={})),function(Garden_Update_Column){Garden_Update_Column.BoardObject="board_object",Garden_Update_Column.Game="game",Garden_Update_Column.Id="id"}(exports.Garden_Update_Column||(exports.Garden_Update_Column={})),function(House_Constraint){House_Constraint.HousePkey="house_pkey"}(exports.House_Constraint||(exports.House_Constraint={})),function(House_Food_Demand_Constraint){House_Food_Demand_Constraint.HouseFoodDemandPkey="house_food_demand_pkey"}(exports.House_Food_Demand_Constraint||(exports.House_Food_Demand_Constraint={})),function(House_Food_Demand_Select_Column){House_Food_Demand_Select_Column.FoodKind="food_kind",House_Food_Demand_Select_Column.FoodQuantity="food_quantity",House_Food_Demand_Select_Column.House="house"}(exports.House_Food_Demand_Select_Column||(exports.House_Food_Demand_Select_Column={})),function(House_Food_Demand_Update_Column){House_Food_Demand_Update_Column.FoodKind="food_kind",House_Food_Demand_Update_Column.FoodQuantity="food_quantity",House_Food_Demand_Update_Column.House="house"}(exports.House_Food_Demand_Update_Column||(exports.House_Food_Demand_Update_Column={})),function(House_Select_Column){House_Select_Column.BoardObject="board_object",House_Select_Column.Game="game",House_Select_Column.HasGarden="has_garden",House_Select_Column.Id="id",House_Select_Column.IsExtra="is_extra",House_Select_Column.Number="number",House_Select_Column.Orient="orient"}(exports.House_Select_Column||(exports.House_Select_Column={})),function(House_Update_Column){House_Update_Column.BoardObject="board_object",House_Update_Column.Game="game",House_Update_Column.HasGarden="has_garden",House_Update_Column.Id="id",House_Update_Column.IsExtra="is_extra",House_Update_Column.Number="number",House_Update_Column.Orient="orient"}(exports.House_Update_Column||(exports.House_Update_Column={})),function(Order_By){Order_By.Asc="asc",Order_By.AscNullsFirst="asc_nulls_first",Order_By.AscNullsLast="asc_nulls_last",Order_By.Desc="desc",Order_By.DescNullsFirst="desc_nulls_first",Order_By.DescNullsLast="desc_nulls_last"}(exports.Order_By||(exports.Order_By={})),function(Player_Constraint){Player_Constraint.PlayerPkey="player_pkey"}(exports.Player_Constraint||(exports.Player_Constraint={})),function(Player_Food_Constraint){Player_Food_Constraint.PlayerFoodPkey="player_food_pkey"}(exports.Player_Food_Constraint||(exports.Player_Food_Constraint={})),function(Player_Food_Select_Column){Player_Food_Select_Column.FoodKind="food_kind",Player_Food_Select_Column.FoodQuantity="food_quantity",Player_Food_Select_Column.Player="player"}(exports.Player_Food_Select_Column||(exports.Player_Food_Select_Column={})),function(Player_Food_Update_Column){Player_Food_Update_Column.FoodKind="food_kind",Player_Food_Update_Column.FoodQuantity="food_quantity",Player_Food_Update_Column.Player="player"}(exports.Player_Food_Update_Column||(exports.Player_Food_Update_Column={})),function(Player_Select_Column){Player_Select_Column.Cash="cash",Player_Select_Column.Colour="colour",Player_Select_Column.Game="game",Player_Select_Column.Id="id",Player_Select_Column.Name="name"}(exports.Player_Select_Column||(exports.Player_Select_Column={})),function(Player_Update_Column){Player_Update_Column.Cash="cash",Player_Update_Column.Colour="colour",Player_Update_Column.Game="game",Player_Update_Column.Id="id",Player_Update_Column.Name="name"}(exports.Player_Update_Column||(exports.Player_Update_Column={})),function(Road_Connection_Constraint){Road_Connection_Constraint.RoadConnectionPkey="road_connection_pkey"}(exports.Road_Connection_Constraint||(exports.Road_Connection_Constraint={})),function(Road_Connection_Select_Column){Road_Connection_Select_Column.Id="id",Road_Connection_Select_Column.Number="number"}(exports.Road_Connection_Select_Column||(exports.Road_Connection_Select_Column={})),function(Road_Connection_Update_Column){Road_Connection_Update_Column.Id="id",Road_Connection_Update_Column.Number="number"}(exports.Road_Connection_Update_Column||(exports.Road_Connection_Update_Column={})),function(Road_Constraint){Road_Constraint.RoadPkey="road_pkey"}(exports.Road_Constraint||(exports.Road_Constraint={})),function(Road_Select_Column){Road_Select_Column.Game="game",Road_Select_Column.Id="id"}(exports.Road_Select_Column||(exports.Road_Select_Column={})),function(Road_Update_Column){Road_Update_Column.Game="game",Road_Update_Column.Id="id"}(exports.Road_Update_Column||(exports.Road_Update_Column={})),function(User_Info_Constraint){User_Info_Constraint.UserInfoDisplayNameKey="user_info_display_name_key",User_Info_Constraint.UserPkey="user_pkey"}(exports.User_Info_Constraint||(exports.User_Info_Constraint={})),function(User_Info_Select_Column){User_Info_Select_Column.AvatarUrl="avatar_url",User_Info_Select_Column.DisplayName="display_name",User_Info_Select_Column.Id="id",User_Info_Select_Column.Name="name",User_Info_Select_Column.Nickname="nickname"}(exports.User_Info_Select_Column||(exports.User_Info_Select_Column={})),function(User_Info_Update_Column){User_Info_Update_Column.AvatarUrl="avatar_url",User_Info_Update_Column.DisplayName="display_name",User_Info_Update_Column.Id="id",User_Info_Update_Column.Name="name",User_Info_Update_Column.Nickname="nickname"}(exports.User_Info_Update_Column||(exports.User_Info_Update_Column={})),function(User_Me_Select_Column){User_Me_Select_Column.DisplayName="display_name",User_Me_Select_Column.Id="id",User_Me_Select_Column.Name="name",User_Me_Select_Column.Nickname="nickname"}(exports.User_Me_Select_Column||(exports.User_Me_Select_Column={})),exports.SelfDocument=client_1.gql`
  query Self {
    user_me {
      display_name
      id
      name
      nickname
    }
  }
`,exports.useSelfQuery=function(baseOptions){const options={...defaultOptions,...baseOptions};return Apollo.useQuery(exports.SelfDocument,options)},exports.useSelfLazyQuery=function(baseOptions){const options={...defaultOptions,...baseOptions};return Apollo.useLazyQuery(exports.SelfDocument,options)},exports.SetDisplayNameByUserIdDocument=client_1.gql`
  mutation SetDisplayNameByUserID($id: String!, $display_name: String!) {
    update_user_info_by_pk(
      pk_columns: { id: $id }
      _set: { display_name: $display_name }
    ) {
      display_name
    }
  }
`,exports.useSetDisplayNameByUserIdMutation=function(baseOptions){const options={...defaultOptions,...baseOptions};return Apollo.useMutation(exports.SetDisplayNameByUserIdDocument,options)}},264:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__(752).__exportStar(__webpack_require__(657),exports)},657:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.apolloBootstrapper=void 0;const client_1=__webpack_require__(114),ws_1=__webpack_require__(5),utilities_1=__webpack_require__(596);exports.apolloBootstrapper=(uri,secure,access,token,cacheConfig={},customFetch=fetch,customWs=WebSocket,options={})=>{const headers="user"===access?{Authorization:`Bearer ${token()}`}:{"x-hasura-admin-secret":`${token()}`},httpLink=client_1.createHttpLink({uri:`${secure?"https":"http"}://${uri}`,headers:{...headers},fetch:customFetch}),wsLink=new ws_1.WebSocketLink({uri:`${secure?"wss":"ws"}://${uri}`,options:{lazy:!0,reconnect:!0,connectionParams:async()=>({headers:{...headers}})},webSocketImpl:customWs}),link=client_1.split((({query})=>{const{kind,operation}=utilities_1.getMainDefinition(query);return"OperationDefinition"===kind&&"subscription"===operation}),wsLink,httpLink);return new client_1.ApolloClient({cache:new client_1.InMemoryCache(cacheConfig),link,defaultOptions:options,connectToDevTools:!0})}},114:module=>{module.exports=require("@apollo/client")},5:module=>{module.exports=require("@apollo/client/link/ws")},596:module=>{module.exports=require("@apollo/client/utilities")},297:module=>{module.exports=require("apollo-datasource")},55:module=>{module.exports=require("apollo-server-express")},167:module=>{module.exports=require("axios")},31:module=>{module.exports=require("cross-fetch")},860:module=>{module.exports=require("express")},779:module=>{module.exports=require("express-jwt")},835:module=>{module.exports=require("jwks-rsa")},752:module=>{module.exports=require("tslib")},345:module=>{module.exports=require("type-graphql")},352:module=>{module.exports=require("ws")}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}var __webpack_exports__={};(()=>{var exports=__webpack_exports__;Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__(752),graphql_utils_1=__webpack_require__(264),apollo_server_express_1=__webpack_require__(55),cross_fetch_1=tslib_1.__importDefault(__webpack_require__(31)),express_1=tslib_1.__importDefault(__webpack_require__(860)),express_jwt_1=tslib_1.__importDefault(__webpack_require__(779)),jwks_rsa_1=tslib_1.__importDefault(__webpack_require__(835)),type_graphql_1=__webpack_require__(345),authChecker_1=__webpack_require__(359),auth0_api_1=__webpack_require__(400),food_api_1=__webpack_require__(543),register_1=__webpack_require__(242),ws=__webpack_require__(352);(async()=>{const client=graphql_utils_1.apolloBootstrapper(process.env.HASURA_URI,"secure"===process.env.SECURE_HASURA,"admin-secret",(()=>process.env.HASURA_ADMIN_SECRET_FOOD),{},cross_fetch_1.default,ws,{query:{fetchPolicy:"no-cache"},mutate:{fetchPolicy:"no-cache"}}),schema=await type_graphql_1.buildSchema({resolvers:[register_1.RegisterResolver],authChecker:authChecker_1.authChecker,emitSchemaFile:!0}),app=express_1.default(),server=new apollo_server_express_1.ApolloServer({schema,context:({req})=>{const context={req,user:req.user};return req.user&&context.req.user[process.env.HASURA_NAMESPACE]&&(context.req.user[process.env.HASURA_NAMESPACE]["x-hasura-allowed-roles"]&&(context.roles=context.req.user[process.env.HASURA_NAMESPACE]["x-hasura-allowed-roles"]),context.req.user[process.env.HASURA_NAMESPACE]["x-hasura-user-id"]&&(context.id=context.req.user[process.env.HASURA_NAMESPACE]["x-hasura-user-id"])),context},dataSources:()=>({FoodAPI:new food_api_1.FoodAPI(client),auth0API:new auth0_api_1.Auth0API}),introspection:!0});app.use("/graphql",express_jwt_1.default({credentialsRequired:!1,secret:jwks_rsa_1.default.expressJwtSecret({cache:!0,rateLimit:!0,jwksRequestsPerMinute:5,jwksUri:`https://${process.env.AUTH0_DOMAIN}/.well-known/jwks.json`}),audience:process.env.AUTH0_CLIENT_ID,issuer:[`https://${process.env.AUTH0_DOMAIN}/`],algorithms:["RS256"]})),await server.start(),server.applyMiddleware({app,path:"/graphql"}),app.listen({port:process.env.PORT||4e3},(()=>console.log(`🚀 Server ready at http://localhost:${process.env.PORT||4e3}${server.graphqlPath}`)))})()})();var __webpack_export_target__=exports;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();
//# sourceMappingURL=main.js.map